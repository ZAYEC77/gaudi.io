---
layout: default
title: "How-to install a Symfony application with gaudi"
description: "A tutorial showing how to build a Symfony plateform with Apache and MySQL"
body: how-to-symfony
---

<div class="container page">

    <h1>HOW TO: Run a Symfony Application</h1>

    <p>
        gaudi just requires a configuration file in order to run an architecture.
        As there is never enough documentation and/or tutorials, this is a full example of how to build and run a
        Symfony project that can display a username from the database.
        <br>
        To run a Symfony app, we need an Apache server, a PHP-FPM app and a MySQL database.

    </p>

    <h2>Create the Configuration File</h2>

    <p>
        Create a <code>.gaudi.yml</code> file in a new folder:
        <script src="https://gist.github.com/DaphDaOne/68195b4dcc07fb352de2.js"></script>
    </p>

    <p>It defines 3 applications.</p>

    <h4>Front</h4>

    <p>This application is the Apache server. It redirects all PHP requests to the PHP-FPM application.</p>
    <p>
        The <code>volumes</code> option mounts a folder of the host machine in the container:
        we mount the current folder (<code>.</code>) in <code>/var/www</code>.
    </p>
    <p>
        The <code>custom option</code> defines the <a href="https://github.com/marmelab/gaudi#types">
        specific configuration of an application</a>.
        <ul>
            <li>Activate fastcgi to indicate which application will receive the fastcgi requests.</li>
            <li>Specify document root into the <code>web</code> folder (default configuration for a Symfony application)</li>
            <li>Enable the <code>mod_rewrite</code> module for Apache</li>
        </ul>
    </p>
    <p>Link the application to the PHP-FPM one called <code>app</code>.</p>

    <h4>PHP-FPM</h4>
    <p>The PHP-FPM app also mount the current folder to <code>/var/www</code>. This tells PHP which file to process.</p>
    <p>It is linked to the <code>db</code> application.</p>

    <h4>MySQL</h4>
    <p>The MySQL application store all its data into the <code>/var/lib/mysql</code> by default.</p>
    <p>As Docker does not keep data when a container is removed, we need to mount a folder from the host machine into <code>/var/lib/mysql</code>.</p>
    <p>The <code>after_script</code> runs the script after the launch of MySQL: In this example, create a new database.</p>


    <h2>Starting the Architecture</h2>

    <p>To start the Symfony app, run in the current folder:</p>
    <script src="https://gist.github.com/DaphDaOne/a7e54e671b3d47c6fa20.js"></script>

    <p>
        The building process can take a few minutes the first time.
        Thereafter Docker will detect the differences between the last build and run only what needed.
    </p>
    <p>The 3 applications are now started: we can attach the <code>app</code> application to install Symfony.</p>

    <h2>Install Symfony</h2>

    <p>To run some php commands in the PHP-FPM application, use the <code>docker attach</code> command.</p>
    <script src="https://gist.github.com/DaphDaOne/e001fe8921a57db28608.js"></script>

    <h2>Configure Symfony</h2>

    <h4>Retrieve The Database IP</h4>

    <p>Create the <code>app/config/parameters.php</code> file to retrieve the <code>db</code> host in the Symfony configuration :</p>
    <script src="https://gist.github.com/DaphDaOne/e2ceafdb47af8cd4de2f.js"></script>

    <p>Change the <code>app/config/config.yml</code> to include this new file after the inclusion of <code>parameters.yml</code> :</p>
    <script src="https://gist.github.com/DaphDaOne/635fdd64ab67d20f6a81.js"></script>

    <h4>Creating the Database</h4>

    <p>Create a new entity in <code>src/Acme/DemoBundle/Entity/User.php</code> :</p>
    <script src="https://gist.github.com/DaphDaOne/27a0a0bbcdcf458dd7ad.js"></script>

    <p>Create the database :</p>
    <script src="https://gist.github.com/DaphDaOne/0cf869df8fc57c03deac.js"></script>

    <p>Detach the app with <code>ctrl+p</code> <code>ctrl+q</code>.</p>

    <h4>Populating the Database</h4>

    <p>To retrieve the <code>db</code> IP, simply run :</p>
    <script src="https://gist.github.com/DaphDaOne/eb3da23099f2d353f08a.js"></script>

    <p>Create a new user in the database :</p>
    <script src="https://gist.github.com/DaphDaOne/3270511cf882383ea087.js"></script>

    <h4>Retrieve User From the Database</h4>

    <p>To check if Symfony can retrieve this user, add in the <code>src/Acme/DemoBunde/Controller/DemoController.php</code> :</p>
    <script src="https://gist.github.com/DaphDaOne/6e515073fb5c926b4d1a.js"></script>

</div>
